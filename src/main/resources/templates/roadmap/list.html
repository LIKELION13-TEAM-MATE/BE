<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë¡œë“œë§µ</title>
</head>
<body>

<p>
    <a th:href="@{/home/main}">&lt;</a>
</p>
<h3 th:text="${project.category}">ì¹´í…Œê³ ë¦¬</h3>
<h2 th:text="${project.projectName}">í”„ë¡œì íŠ¸ ì´ë¦„</h2>

<p>
    <a th:href="@{/project/detail/{id}(id=${projectId})}">ê²Œì‹œíŒ</a> |
    <a th:href="@{/project/{id}/roles(id=${project.id})}">ì—­í• </a> |
    <a th:href="@{/project/{projectId}/events/calendar(projectId=${projectId})}">ì¼ì •</a> |
    <span>ë¡œë“œë§µ</span> |
    <a th:href="@{/project/{id}/chatrooms(id=${project.id}, memberId=${memberId})}">ëŒ€í™”ë°©</a>
</p>
<hr/>

<div>
    <h3>
        ì „ì²´ ì§„í–‰ë¥ : <span th:text="${totalProgress}">0</span>%
    </h3>

    <h3>
        <span th:text="${project.dDay}">(D-Day)</span>
    </h3>

    <p>
        ë‹¨ê³„ <span th:text="${completedCount}">0</span> / <span th:text="${totalCount}">0</span>
    </p>

    <p>
        <a th:href="@{/project/{id}/roadmap/create(id=${project.id})}">ë‹¨ê³„ ì¶”ê°€</a>
    </p>
</div>
<hr/>

<!--ê° ë‹¨ê³„-->
<div th:each="roadmap : ${roadmaps}">

    <div>
        <strong th:text="${roadmap.role}">1ë‹¨ê³„</strong>
        <h3><span th:text="${roadmap.title}">ê¸°íš</span></h3>
        <!--ë™ì—…ì ì •ë³´-->
        <div style="display: flex; gap: 10px; margin-top: 5px;">
            <div th:each="rm : ${roadmap.members}" style="display: flex; align-items: center;">
                <div th:if="${rm.member.nickname != null}"
                     th:style="|background-color: ${rm.member.avatarColor};
                       width: 24px; height: 24px; border-radius: 50%;
                       display: flex; align-items: center; justify-content: center;
                       color: white; font-weight: bold; font-size: 0.8em; margin-right: 5px;|">
                    <span th:text="${rm.member.initial}"></span>
                </div>
                <span th:text="${rm.member.nickname}" style="font-size: 0.9em; color: #555;">ì´ë¦„</span>
            </div>
        </div>
        <!--ìˆ˜ì •&ì‚­ì œ-->
        <div>
            <a th:href="@{/roadmap/{rid}/edit(rid=${roadmap.id}, projectId=${project.id})}" style="text-decoration: none;">ìˆ˜ì •</a>

            <form th:action="@{/roadmap/{rid}/delete(rid=${roadmap.id})}" method="post" style="display:inline;">
                <input type="hidden" name="projectId" th:value="${project.id}"/>
                <button type="submit" onclick="return confirm('ì´ ë‹¨ê³„ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? í¬í•¨ëœ Taskë„ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')">
                    ì‚­ì œ
                </button>
            </form>
        </div>
    </div>

    <div>
        <span>~</span><span th:text="${roadmap.deadline}">2025-11-11</span>
        <br/>
        <span>ì§„í–‰ë¥ : </span><span th:text="${roadmap.progress}">0</span>%
    </div>

    <!--Task-->
    <ul style="list-style: none; padding-left: 0;">
        <li th:each="task : ${roadmap.tasks}">

            <form th:action="@{/roadmap/{taskId}/check(taskId=${task.id})}" method="post" style="display:inline;">
                <input type="hidden" name="projectId" th:value="${project.id}"/>
                <button type="submit">
                    <span th:if="${task.checked}">âœ…</span>
                    <span th:unless="${task.checked}">â¬œ</span>
                </button>
            </form>

            <span th:text="${task.content}">í•  ì¼ ë‚´ìš©</span>

            <!--ì£¼ì„(Comment) ì…ë ¥ ë²„íŠ¼-->
            <button type="button" th:onclick="'toggleNoteForm(' + ${task.id} + ')'">ğŸ’¬</button>

            <!--Task ì‚­ì œ-->
            <form th:action="@{/roadmap/task/{taskId}/delete(taskId=${task.id})}" method="post" style="display:inline;">
                <input type="hidden" name="projectId" th:value="${project.id}"/>
                <button type="submit" onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">X</button>
            </form>

            <!--ì£¼ì„ë‚´ìš©-->
            <div th:if="${task.note != null && !task.note.isEmpty()}">
                <small><span th:text="${task.note}">ë‚´ìš©</span></small>
            </div>

            <!--ì£¼ì„ ì…ë ¥ë€-->
            <div th:id="'noteForm-' + ${task.id}" style="display: none;">
                <form th:action="@{/roadmap/task/{taskId}/note(taskId=${task.id})}" method="post">
                    <input type="hidden" name="projectId" th:value="${project.id}"/>
                    <input type="text" name="note" th:value="${task.note}" placeholder="ì£¼ì„ ì…ë ¥">
                    <button type="submit">ë“±ë¡</button>
                </form>
            </div>
        </li>
    </ul>

    <!--Task ì…ë ¥-->
    <form th:action="@{/roadmap/{rid}/task/add(rid=${roadmap.id})}" method="post">
        <input type="hidden" name="projectId" th:value="${project.id}"/>
        <input type="text" name="content" placeholder="ì„¸ë¶€ Task ì…ë ¥" required>
        <button type="submit">ë“±ë¡</button>
    </form>

    <hr/> </div>

<script>
    function toggleNoteForm(taskId) {
        var formDiv = document.getElementById('noteForm-' + taskId);
        if (formDiv.style.display === 'none') {
            formDiv.style.display = 'block';
        } else {
            formDiv.style.display = 'none';
        }
    }
</script>

</body>
</html>